
#include<reg52.h>    
#include <intrins.h> 
#define uchar unsigned char
#define uint unsigned int


sbit D=P1^5; //Pin14 ????
sbit Out=P1^6 ;//Pin12 RCLK 锁存器输出
sbit SRCLK=P1^7;	// Pin11 SRCLK 数据输入
sbit  OutA=P1^3;  //154 上16行控制  0使能输出
sbit  OutB=P1^4;  // 154 下16行控制 0
sbit 	KEY=P1^2;

unsigned char code LED4[]={
	/* 子*/
  0xFF,0xFF,0xC0,0x0F,0xFF,0xEF,0xFF,0xDF,0xFF,0xBF,0xFE,0x7F,0xFE,0xFF,0x00,0x01,
	0xFE,0xFF,0xFE,0xFF,0xFE,0xFF,0xFE,0xFF,0xFE,0xFF,0xFE,0xFF,0xFA,0xFF,0xFC,0xFF
};

unsigned char code LED3[]={
  0xFD,0xFF,0xFD,0xFF,0xFD,0xFF,0x80,0x0F,0xBD,0xEF,0xBD,0xEF,0x80,0x0F,0xBD,0xEF,
  0xBD,0xEF,0x80,0x0F,0xFD,0xFF,0xFD,0xFF,0xFD,0xFB,0xFD,0xFB,0xFC,0x03,0xFF,0xFF
};

unsigned char code LED2[]={
0xFF,0xFF,0xFF,0xFF,0x80,0x03,0xFE,0xFF,0xFE,0xFF,0xFE,0xFF,0xFE,0xFF,0xFE,0xFF,
0xFE,0xFF,0xFE,0xFF,0xFE,0xFF,0xFE,0xFF,0xFE,0xFF,0x00,0x01,0xFF,0xFF,0xFF,0xFF};


unsigned char code LED1[]={
0xBE,0xBF,0xCE,0xDF,0xEE,0xFB,0xFC,0x01,0x79,0xDF,0x95,0xD7,0xDC,0x03,0xF5,0xDF,
0xED,0xD7,0xDC,0x03,0x1D,0xDF,0xDD,0xDF,0xDD,0xDB,0xDC,0x01,0xDD,0xFF,0xDD,0xFF};


unsigned int Data=0xAA;

void Delay(uint n)   // 延时毫秒
{
   uchar i;
   while(n--)
   {
     for(i=0;i<120;i++);
}
}

// 595 调用函数
void HC595SendData (unsigned int SendVal)
{
	int i;
	for(i=0;i<8;i++)
	{
		if(((SendVal << i)&0x80) !=0)
				D=1;
	   else 
			 D=0;
		 SRCLK=0;
		 Delay(0);
		 SRCLK=1;
	}
		// Out=0;
		// Out=1;
}

/*完整显示函数 输入 变量从哪一行开始*/
		void ShowLed(unsigned int Line)
		{
    	int i;
				OutA=0;
			for(i=0;i<16;i++,Line++)
			{
				P0=Line;
				HC595SendData(LED2[2*i+1]);  // 给32位数据
				HC595SendData(LED2[2*i]);
				HC595SendData(LED1[2*i+1]);
				HC595SendData(LED1[2*i]);
				Out=0;   //数据输入
				Out=1;
				Delay(7);
			}
			OutA=1;
			OutB=0;
			Line -=0x10;
			for(i=0;i<16;i++,Line+=0x10)
			{
				
				P0=Line;
				HC595SendData(LED4[2*i+1]);  // 给32位数据
				HC595SendData(LED4[2*i]);
				HC595SendData(LED3[2*i+1]);
				HC595SendData(LED3[2*i]);
				Out=0;   //数据输入
				Out=1;
				Delay(7);
			}
		OutB=1;
		
		}
		


void main()
{
	int Line;

	KEY=1;
		while(1){
			Line=0x00;
			ShowLed(Line);
			if(!KEY){
			
				}
		}
	
}


